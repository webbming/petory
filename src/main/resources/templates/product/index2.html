<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤í† ì–´</title>
    <link rel="stylesheet" href="/css/layout/common.css"> <!-- ê³µí†µ CSS -->

    <!-- Swiper CSS (ì´ë¯¸ ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš© ì¤‘ì´ë©´ ì¤‘ë³µ ì£¼ì˜) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>

    <style>
        /* ===== ê³µí†µ(ë¼ì´í« ìœ ì‚¬) ===== */
        body {
          margin: 0;
          font-family: 'Roboto', sans-serif;
          background-color: #f9fbfd; /* ë°ì€ ê·¸ë ˆì´í†¤ ë°°ê²½ */
          color: #333;
        }
        .container {
          max-width: 1200px;
          margin: 0 auto;
        }
        .pm-section {
          padding: 20px 0;
          margin-top: 80px; /* ë„¤ë¹„ê²Œì´ì…˜ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
        }

        /* ì‚¬ì´ë“œë°” + ì½˜í…ì¸  (ì „ì²´ì œí’ˆ(all) ë“±ì—ì„œ ì‚¬ìš©) */
        .main-container {
          display: flex;
          min-height: calc(100vh - 60px);
        }
        .sidebar {
          width: 240px;
          background-color: #fff;
          box-shadow: 0 2px 4px rgba(0,0,0,0.05);
          padding: 1rem;
          border-radius: 4px;
        }
        .content {
          flex: 1;
          padding: 1rem 2rem;
        }

        /* ìƒí’ˆ ëª©ë¡(ê¸°ë³¸ 4ì—´) */
        .product-list {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 1rem;
          list-style: none;
          margin: 0;
          padding: 0;
        }
        .product-card {
          background: #fff;
          border-radius: 4px;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          text-align: center;
          padding: 1rem;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        .product-card img {
          width: 100%;
          height: 200px;
          object-fit: cover;
          border-radius: 4px;
        }
        .product-card h3 {
          margin: 1rem 0 0.5rem;
          font-size: 1rem;
          font-weight: bold;
        }
        .product-card .price {
          font-size: 1rem;
          font-weight: bold;
          color: #e91e63; /* í•‘í¬ ê³„ì—´ */
          margin-bottom: 0.5rem;
        }
        .product-card .rating {
          font-size: 1rem;
          font-weight: 500;
          color: #FFB400; /* ë³„ ìƒ‰ìƒ */
          margin-bottom: 0.5rem;
        }
        .product-card p.category-info {
          font-size: 0.9rem;
          color: #666;
          margin-bottom: 0.5rem;
        }
        .product-card a.details-link {
          display: inline-block;
          margin-top: 0.5rem;
          padding: 0.4rem 0.8rem;
          background-color: #66aee8;
          color: #fff;
          border-radius: 4px;
          text-decoration: none;
        }
        .product-card a.details-link:hover {
          background-color: #4e9cd8;
        }

        /* ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬ */
        .sidebar h2 {
          margin-top: 0;
          font-size: 1.2rem;
          margin-bottom: 1rem;
          border-bottom: 1px solid #eee;
          padding-bottom: 0.5rem;
          color: #444;
        }
        .category-list {
          list-style: none;
          margin: 0;
          padding: 0;
        }
        .category-list li {
          margin-bottom: 0.5rem;
          background-color: #fff;
          border-radius: 4px;
          padding: 0.6rem 1rem;
          transition: background-color 0.2s;
          font-weight: 500;
          border: 1px solid #eee;
          cursor: pointer;
        }
        .category-list li:hover {
          background-color: #f0f7ff;
        }
        .category-list li a {
          color: #333;
          text-decoration: none;
          display: block;
        }

        /* ëƒ¥/ëŒ•/ALL ë²„íŠ¼ */
        .pet-filter-container {
          margin-top: 1rem;
          display: flex;
          flex-wrap: nowrap;
          gap: 0.5rem;
          justify-content: center;
        }
        .pet-filter-button {
          width: 90px;
          padding: 0.5rem 0;
          font-size: 0.8rem;
          border: 2px solid #66aee8;
          background-color: #fff;
          cursor: pointer;
          border-radius: 5px;
          color: #333;
          text-align: center;
          transition: all 0.3s ease;
        }
        .pet-filter-button.active,
        .pet-filter-button:hover {
          background-color: #66aee8;
          color: #fff;
        }
        .sidebar-buttons {
          margin-top: 1.5rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }
        .sidebar-buttons a {
          background-color: #66aee8;
          color: #fff;
          border: none;
          border-radius: 4px;
          padding: 0.6rem 1rem;
          font-weight: 500;
          text-decoration: none;
          text-align: center;
          transition: background-color 0.2s;
        }
        .sidebar-buttons a:hover {
          background-color: #4e9cd8;
        }

        /* ì„œë¸Œì¹´í…Œê³ ë¦¬ íƒ­ */
        .category-header {
          margin-bottom: 1rem;
        }
        .category-title {
          margin: 0;
          font-size: 1.4rem;
          font-weight: bold;
          color: #333;
        }
        .top-controls {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-top: 0.5rem;
          border-bottom: 1px solid #ddd;
          padding-bottom: 0.5rem;
        }
        .subcategory-tabs {
          display: flex;
          gap: 1rem;
        }
        .subcategory-tabs a {
          position: relative;
          padding: 0.6rem 1rem;
          color: #333;
          text-decoration: none;
          font-weight: 500;
          transition: color 0.2s;
          border-bottom: 2px solid transparent;
        }
        .subcategory-tabs a:hover {
          color: #66aee8;
        }
        .subcategory-tabs a.active {
          color: #66aee8;
          font-weight: 600;
          border-bottom: 2px solid #66aee8;
        }

        /* ìŠ¤í† ì–´í™ˆ ì „ìš© ì„¹ì…˜ */
        .section-title {
          font-size: 1.4rem;
          font-weight: bold;
          margin-bottom: 15px;
        }
        section {
          margin-bottom: 40px;
        }

        /* ë°°ë„ˆ ìŠ¬ë¼ì´ë” ì˜ˆì‹œ */
        .banner-slider-container {
          width: 100%;
          max-width: 1200px;
          margin: 0 auto 30px auto;
          border-radius: 8px;
          overflow: hidden;
        }
        .banner-swiper {
          position: relative;
          width: 100%;
          height: 300px;
        }
        .banner-swiper .swiper-slide img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
        .swiper-button-prev,
        .swiper-button-next {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          z-index: 10;
          width: 50px;
          height: 50px;
          background-color: #fff;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 2px 6px rgba(0,0,0,0.15);
          cursor: pointer;
          color: #000;
          font-size: 18px;
          font-weight: bold;
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .swiper-button-prev::after,
        .swiper-button-next::after {
          color: #000 !important;
          font-size: 18px !important;
          font-weight: bold;
        }
        .swiper-button-prev {
          left: 20px;
        }
        .swiper-button-next {
          right: 20px;
        }
        .banner-swiper:hover .swiper-button-prev,
        .banner-swiper:hover .swiper-button-next {
          opacity: 1;
          visibility: visible;
        }

        /* ë² ìŠ¤íŠ¸/NEW í˜ì´ì§€ìš© - ì¤‘ì•™ì œëª© & 4ì—´ */
        .main_home {
          margin: 0 auto;
          padding: 40px 15px;
          max-width: 1200px;
        }
        .main_home h2 {
          text-align: center;
          font-size: 2rem;
          font-weight: 700;
          margin-bottom: 30px;
        }
        .main_home .product_list {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 20px;
          list-style: none;
          margin: 0;
          padding: 0;
        }
        .main_home .product_list li {
          background: #fff;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          text-align: center;
          padding: 16px;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        .main_home .product_list li:hover {
          transform: translateY(-3px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* ì´ë¯¸ì§€ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ (ë² ìŠ¤íŠ¸/NEW ë“±) */
        .img-wrap {
          position: relative;
          display: inline-block;
        }
        .img-wrap img {
          width: 100%;
          height: 200px;
          object-fit: cover;
          border-radius: 4px;
          display: block;
        }

        /* ë² ìŠ¤íŠ¸ ìˆœë²ˆ(ì´ë¯¸ì§€ ì™¼ìª½ í•˜ë‹¨) */
        .best-rank {
          position: absolute;
          left: 0;
          bottom: 0;
          background-color: #333;
          color: #fff;
          font-weight: bold;
          font-size: 1rem;
          line-height: 1.2;
          padding: 4px 8px;
          border-top-right-radius: 4px; /* ì™¼ìª½ í•˜ë‹¨ ëª¨ì„œë¦¬ë§Œ ë‘¥ê¸€ê²Œ */
        }

        .main_home .product_list li h3 {
          margin: 0.5rem 0;
          font-size: 1rem;
          font-weight: bold;
        }
        .main_home .product_list li .price {
          font-size: 1rem;
          font-weight: bold;
          color: #e91e63;
          margin-bottom: 0.5rem;
        }
        .main_home .product_list li .rating {
          font-size: 1rem;
          font-weight: 500;
          color: #FFB400;
          margin-bottom: 0.5rem;
        }
        .main_home .product_list li .category-info {
          font-size: 0.9rem;
          color: #666;
          margin-bottom: 0.5rem;
        }
        .main_home .product_list li .details-link {
          display: inline-block;
          margin-top: 0.5rem;
          padding: 0.4rem 0.8rem;
          background-color: #66aee8;
          color: #fff;
          border-radius: 4px;
          text-decoration: none;
        }
        .main_home .product_list li .details-link:hover {
          background-color: #4e9cd8;
        }
    </style>
</head>
<body>
<!-- ê³µí†µ í—¤ë” -->
<div th:replace="fragment/header :: headerFragment"></div>

<!-- ìŠ¤í† ì–´ ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
<div th:replace="fragment/nav :: navFragment2"></div>

<div class="container">
  <div class="pm-section">
    <!-- sort ê°’ì— ë”°ë¼ ë¶„ê¸° -->
    <div th:switch="${sort}">

      <!-- ìŠ¤í† ì–´í™ˆ (storeHome) -->
      <div th:case="'storeHome'">
        <!-- â–¼â–¼â–¼ ë°°ë„ˆ ìŠ¬ë¼ì´ë” â–¼â–¼â–¼ -->
        <div class="banner-slider-container">
          <div class="swiper-container banner-swiper">
            <div class="swiper-wrapper">
              <!-- ì˜ˆì‹œ ë°°ë„ˆ -->
              <div class="swiper-slide">
                <img src="/images/v1.jpg" alt="ë°°ë„ˆ1">
              </div>
              <div class="swiper-slide">
                <img src="/images/v2.jpg" alt="ë°°ë„ˆ2">
              </div>
              <div class="swiper-slide">
                <img src="/images/v3.jpg" alt="ë°°ë„ˆ3">
              </div>
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
          </div>
        </div>
        <!-- â–²â–²â–² ë°°ë„ˆ ìŠ¬ë¼ì´ë” ë â–²â–²â–² -->

        <!-- ê°€ì„±ë¹„ ìƒí’ˆ -->
        <section>
          <h2 class="section-title">ê°€ì„±ë¹„ ê°‘! ì•Œëœ°í•˜ê²Œ ë“í…œí•˜ì„¸ìš”</h2>
          <div class="product-list">
            <div class="product-card" th:each="p : ${cheapProducts}">
              <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />
              <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
              <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'">ê°€ê²©</p>
              <p class="rating">
                <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
              </p>
              <p class="category-info"
                 th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'">
              </p>
              <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">
                ìì„¸íˆ ë³´ê¸°
              </a>
            </div>
          </div>
        </section>

        <!-- ë² ìŠ¤íŠ¸ ìƒí’ˆ -->
        <section>
          <h2 class="section-title">ëª¨ë‘ê°€ ì„ íƒí•œ ë² ìŠ¤íŠ¸! í•œ ë²ˆ ì¨ë³´ë©´ ë°˜í•´ìš”</h2>
          <div class="product-list">
            <div class="product-card" th:each="p : ${bestProducts}">
              <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />
              <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
              <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'">ê°€ê²©</p>
              <p class="rating">
                <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
              </p>
              <p class="category-info"
                 th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'">
              </p>
              <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">
                ìì„¸íˆ ë³´ê¸°
              </a>
            </div>
          </div>
        </section>

        <!-- ì‹ ìƒí’ˆ -->
        <section>
          <h2 class="section-title">ë°©ê¸ˆ ì¶œì‹œëœ ë”°ëˆë”°ëˆ ì‹ ìƒ! ì§€ê¸ˆ ë§Œë‚˜ë³´ì„¸ìš”</h2>
          <div class="product-list">
            <div class="product-card" th:each="p : ${newProducts}">
              <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />
              <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
              <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'">ê°€ê²©</p>
              <p class="rating">
                <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
              </p>
              <p class="category-info"
                 th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'">
              </p>
              <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">
                ìì„¸íˆ ë³´ê¸°
              </a>
            </div>
          </div>
        </section>
      </div>

      <!-- ì „ì²´ì œí’ˆ (all) + ì¹´í…Œê³ ë¦¬/ì„œë¸Œì¹´í…Œê³ ë¦¬ -->
      <div th:case="'all'">
        <div class="main-container">
          <!-- ì‚¬ì´ë“œë°” -->
          <aside class="sidebar">
            <h2>ì¹´í…Œê³ ë¦¬</h2>
            <ul class="category-list">
              <li th:each="cat : ${categories}">
                <a th:href="@{'/products/category/' + ${cat.categoryId} (petType=${selectedPetType}, sort='newest')}"
                   th:text="${cat.categoryName}">ì¹´í…Œê³ ë¦¬ëª…</a>
              </li>
            </ul>

            <!-- ëƒ¥/ëŒ•/ALL ë²„íŠ¼ -->
            <div class="pet-filter-container">
              <a class="pet-filter-button"
                 th:classappend="${selectedPetType == 'CAT'} ? ' active'"
                 th:href="@{/products(petType='CAT', sort='all')}">ğŸ± ëƒ¥</a>
              <a class="pet-filter-button"
                 th:classappend="${selectedPetType == 'DOG'} ? ' active'"
                 th:href="@{/products(petType='DOG', sort='all')}">ğŸ¶ ëŒ•</a>
              <a class="pet-filter-button"
                 th:href="@{/products(sort='all')}">ALL</a>
            </div>

            <div class="sidebar-buttons">
              <a href="/products/add">ìƒí’ˆ ì¶”ê°€</a>
              <a href="/categories">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</a>
            </div>
          </aside>
          
          <!-- ë©”ì¸ ì˜ì—­ -->
          <div class="content">
            <!-- ì„œë¸Œì¹´í…Œê³ ë¦¬ íƒ­: currentCategoryê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ -->
            <div class="category-header" th:if="${currentCategory != null}">
              <h2 class="category-title" th:text="${currentCategory.categoryName}">ì¹´í…Œê³ ë¦¬ëª…</h2>
              <div class="top-controls">
                <div class="subcategory-tabs">
                  <!-- ì „ì²´ íƒ­ -->
                  <a th:href="@{'/products/category/' + ${currentCategory.categoryId} (petType=${selectedPetType}, sort='newest')}"
                     th:classappend="${selectedSubcategoryId == null} ? ' active'">ì „ì²´</a>
                  <!-- ì„œë¸Œì¹´í…Œê³ ë¦¬ íƒ­ -->
                  <a th:each="sub : ${subcategories}"
                     th:href="@{'/products/subcategory/' + ${sub.subcategoryId} (petType=${selectedPetType}, sort='newest')}"
                     th:classappend="${selectedSubcategoryId == sub.subcategoryId} ? ' active'">
                    <span th:text="${sub.subcategoryName}">ì†Œë¶„ë¥˜</span>
                  </a>
                </div>
                <!-- ì •ë ¬ ì…€ë ‰íŠ¸ -->
                <div class="sort-container">
                  <label for="sortFilter">ì •ë ¬:</label>
                  <select id="sortFilter" onchange="changeSort()">
                    <option value="newest" th:selected="${sort == 'newest'}">ì‹ ì œí’ˆìˆœ</option>
                    <option value="priceLowHigh" th:selected="${sort == 'priceLowHigh'}">ë‚®ì€ ê°€ê²©ìˆœ</option>
                    <option value="priceHighLow" th:selected="${sort == 'priceHighLow'}">ë†’ì€ ê°€ê²©ìˆœ</option>
                    <option value="rating" th:selected="${sort == 'rating'}">í‰ì ìˆœ</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- ìƒí’ˆ ëª©ë¡ (all) -->
            <div class="product-list">
              <div class="product-card" th:each="product : ${products}">
                <img th:src="@{${!#lists.isEmpty(product.imageUrls) ? product.imageUrls[0] : '/images/default.png'}}" alt="Product Image"/>
                <h3 th:text="${product.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(product.price, 0)} + 'ì›'">ê°€ê²©</p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(product.averageRating != null ? product.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${product.reviewCount} != null ? ${product.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="category-info"
                   th:text="'(' + ${product.category.categoryName} + ' / ' + ${product.subcategory.subcategoryName} + ')'">
                </p>
                <a th:href="@{'/products/' + ${product.productId}}" class="details-link" th:if="${product.productId != null}">
                  ìì„¸íˆ ë³´ê¸°
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ë² ìŠ¤íŠ¸ (rating): ì‚¬ì´ë“œë°” ì—†ì´ ì¤‘ì•™ì œëª© + 4ì—´ -->
      <div th:case="'rating'">
        <div class="main_home best_area">
          <h2>ë² ìŠ¤íŠ¸</h2>
          <ul class="product_list">
            <!-- p, stat : ${products}ë¡œ iteration statusë¥¼ í•¨ê»˜ ë°›ìŒ -->
            <li th:each="p, stat : ${products}">
              <!-- ì´ë¯¸ì§€ ê°ì‹¸ëŠ” div (ì´ë¯¸ì§€ + ë²ˆí˜¸ ë±ƒì§€) -->
              <div class="img-wrap">
                <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                <!-- ë² ìŠ¤íŠ¸ ë²ˆí˜¸ (ì´ë¯¸ì§€ ì™¼ìª½ í•˜ë‹¨) -->
                <span class="best-rank" th:text="${stat.count}">1</span>
              </div>

              <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
              <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'">ê°€ê²©</p>
              <p class="rating">
                <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
              </p>
              <p class="category-info"
                 th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'">
              </p>
              <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">
                ìì„¸íˆ ë³´ê¸°
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- NEW (newest): ì‚¬ì´ë“œë°” ì—†ì´ ì¤‘ì•™ì œëª© + 4ì—´ -->
      <div th:case="'newest'">
        <div class="main_home new_area">
          <h2>NEW</h2>
          <ul class="product_list">
            <li th:each="p : ${products}">
              <!-- ì´ë¯¸ì§€ ê°ì‹¸ëŠ” div (ë™ì¼ êµ¬ì¡°, ë‹¨ ë²ˆí˜¸ ë±ƒì§€ ì—†ìŒ) -->
              <div class="img-wrap">
                <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
              </div>

              <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
              <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'">ê°€ê²©</p>
              <p class="rating">
                <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
              </p>
              <p class="category-info"
                 th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'">
              </p>
              <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">
                ìì„¸íˆ ë³´ê¸°
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- ê¸°íƒ€ fallback -->
      <div th:case="*">
        <p>ì•Œ ìˆ˜ ì—†ëŠ” íƒ­ì…ë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>
</div>

<!-- í‘¸í„° -->
<div th:replace="fragment/footer :: footerFragment"></div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script>
    function changeSort() {
        const selectedSort = document.getElementById("sortFilter").value;
        const url = new URL(window.location.href);
        url.searchParams.set("sort", selectedSort);
        window.location.href = url.toString();
    }

    document.addEventListener('DOMContentLoaded', function() {
        // ê°€ê²© í‘œì‹œë¥¼ "xx,xxxì›" í˜•íƒœë¡œ ë³€ê²½
        const priceElements = document.querySelectorAll('.price');
        priceElements.forEach(el => {
          const rawText = el.textContent.replace(/[^\d]/g,'');
          const priceNum = parseInt(rawText, 10) || 0;
          const formatted = priceNum.toLocaleString('en-US') + 'ì›';
          el.textContent = formatted;
        });

        // Swiper ë°°ë„ˆ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
        new Swiper('.banner-swiper', {
          loop: true,
          autoplay: {
            delay: 3000,
            disableOnInteraction: false
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
          }
        });
    });
</script>
</body>
</html>
