<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ìŠ¤í† ì–´</title>
  <link rel="stylesheet" href="/css/layout/common.css"> <!-- ê³µí†µ CSS -->
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>

  <style>
    /* ===== ê³µí†µ (ë¼ì´í« ìœ ì‚¬) ===== */
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #fff;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    /* ê°„ê²© ì¡°ê¸ˆ ì¤„ì´ê¸° */
    .pm-section {
      padding: 20px 0; /* ê¸°ì¡´ 40px -> 20px */
      margin-top: 70px; /* ê¸°ì¡´ 80px -> 70px */
    }
    .main-container {
      display: flex;
      min-height: calc(100vh - 60px);
    }
    .sidebar {
      width: 240px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      padding: 1rem;
      border-radius: 4px;
    }
    .content {
      flex: 1;
      padding: 1rem 2rem;
    }

    /* ===== ìƒí’ˆ ëª©ë¡ (4ì—´), ì¹´ë“œ ë””ìì¸ ===== */
    .product-list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      /* ê°„ê²© ì¡°ê¸ˆ ì¤„ì´ê¸° */
      gap: 0.8rem; /* ê¸°ì¡´ 1rem -> 0.8rem */
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .product-card {
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      text-align: center;
      padding: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }
    .product-card h3 {
      margin: 0.8rem 0 0.3rem;
      font-size: 1rem;
      font-weight: 600;
      color: #333;
    }
    .product-card .rating {
      font-size: 0.9rem;
      font-weight: 400;
      color: #666;
      margin-bottom: 0.4rem;
    }
    .product-card .price {
      font-size: 1.05rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.4rem;
    }
    .product-card p.category-info {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 0.5rem;
    }
    .delivery-badge {
      display: inline-flex;
      align-items: center;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      color: #666;
    }
    .delivery-badge img {
      width: 18px;
      height: 18px;
      margin-right: 4px;
    }
    .product-card a.details-link {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.4rem 0.8rem;
      background-color: #66aee8;
      color: #fff;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .product-card a.details-link:hover {
      background-color: #4e9cd8;
    }

    /* ===== ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬ ===== */
    .sidebar h2 {
      margin-top: 0;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.5rem;
      color: #444;
    }
    .category-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .category-list li {
      margin-bottom: 0.5rem;
      background-color: #fff;
      border-radius: 4px;
      padding: 0.6rem 1rem;
      transition: background-color 0.2s;
      font-weight: 500;
      border: 1px solid #eee;
      cursor: pointer;
    }
    .category-list li:hover {
      background-color: #f0f7ff;
    }
    .category-list li a {
      color: #333;
      text-decoration: none;
      display: block;
    }

    /* ===== ì‚¬ì´ë“œë°” ë²„íŠ¼ë“¤ ===== */
    .sidebar-buttons {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
    }
    .sidebar-buttons button,
    .sidebar-buttons a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 180px;
      white-space: nowrap;
      background: linear-gradient(to right, #66b6f2, #4e9cd8);
      color: #fff;
      border: none;
      border-radius: 20px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .sidebar-buttons button:hover,
    .sidebar-buttons a:hover {
      background: linear-gradient(to right, #4e9cd8, #66b6f2);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }
    .sidebar-buttons button:active,
    .sidebar-buttons a:active {
      transform: translateY(1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }

    /* ===== ì„œë¸Œì¹´í…Œê³ ë¦¬ íƒ­ ===== */
    .category-header {
      margin-bottom: 1rem;
    }
    .category-title {
      margin: 0;
      font-size: 1.4rem;
      font-weight: bold;
      color: #333;
    }
    .top-controls {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .subcategory-tabs {
      display: flex;
      gap: 1rem;
    }
    .subcategory-tabs a {
      position: relative;
      padding: 0.6rem 1rem;
      color: #333;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
      border-bottom: 2px solid transparent;
    }
    .subcategory-tabs a:hover {
      color: #66aee8;
    }
    .subcategory-tabs a.active {
      color: #66aee8;
      font-weight: 600;
      border-bottom: 2px solid #66aee8;
    }

    /* ===== 'ì´ Nê°œ' & ì •ë ¬ ë²„íŠ¼ì„ í•œ ì¤„ì— ë°°ì¹˜ ===== */
    .count-sort-row {
      margin: 1rem 0;         /* ìœ„ì•„ë˜ ê°„ê²© */
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .count-info {
      font-size: 1rem;
      color: #666;
    }
    .sort-container {
      display: inline-flex;
      align-items: center;
      gap: 6px; /* ì •ë ¬ ë¼ë²¨ê³¼ select ê°„ê²© */
    }

    /* ===== ë°°ë„ˆ ìŠ¬ë¼ì´ë” ===== */
    .banner-slider-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 30px auto;
      border-radius: 8px;
      overflow: hidden;
    }
    .swiper-container.banner-swiper {
      position: relative;
      width: 100%;
      height: 300px;
    }
    .banner-swiper .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .swiper-button-prev,
    .swiper-button-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      width: 50px;
      height: 50px;
      background-color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      cursor: pointer;
      color: #000;
      font-size: 18px;
      font-weight: bold;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .swiper-button-prev::after,
    .swiper-button-next::after {
      color: #000 !important;
      font-size: 18px !important;
      font-weight: bold;
    }
    .swiper-button-prev {
      left: 20px;
    }
    .swiper-button-next {
      right: 20px;
    }
    .banner-swiper:hover .swiper-button-prev,
    .banner-swiper:hover .swiper-button-next {
      opacity: 1;
      visibility: visible;
    }

    /* ===== ë² ìŠ¤íŠ¸/NEW í˜ì´ì§€ (ì¤‘ì•™ì œëª© & 4ì—´) ===== */
    .main_home {
      margin: 0 auto;
      padding: 30px 15px; /* ê°„ê²© ì•½ê°„ ì¤„ì„ */
      max-width: 1200px;
    }
    .main_home h2 {
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
    }
    .main_home .product_list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .main_home .product_list li {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      text-align: center;
      padding: 16px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .main_home .product_list li:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .img-wrap {
      position: relative;
      display: inline-block;
    }
    .img-wrap img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 4px;
      display: block;
    }
    .best-rank {
      position: absolute;
      left: 0;
      bottom: 0;
      background-color: #333;
      color: #fff;
      font-weight: bold;
      font-size: 1rem;
      line-height: 1.2;
      padding: 4px 8px;
      border-top-right-radius: 4px;
    }
    .main_home .product_list li h3 {
      margin: 0.5rem 0;
      font-size: 1rem;
      font-weight: bold;
      color: #333;
    }
    .main_home .product_list li .price {
      font-size: 1.05rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.4rem;
    }
    .main_home .product_list li .rating {
      font-size: 0.9rem;
      font-weight: 400;
      color: #666;
      margin-bottom: 0.4rem;
    }
    .main_home .product_list li .category-info {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 0.5rem;
    }
    .main_home .product_list li .delivery-badge {
      display: inline-flex;
      align-items: center;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      color: #666;
    }
    .main_home .product_list li .delivery-badge img {
      width: 18px;
      height: 18px;
      margin-right: 4px;
    }
    .main_home .product_list li .details-link {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.4rem 0.8rem;
      background-color: #66aee8;
      color: #fff;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .main_home .product_list li .details-link:hover {
      background-color: #4e9cd8;
    }

    /* ===== ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ ë°”ë¡œê°€ê¸° (ìŠ¤í† ì–´í™ˆ) ===== */
    .category-shortcut {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .category-shortcut ul {
      list-style: none;
      display: flex;
      gap: 40px;
      margin: 0;
      padding: 0;
    }
    .category-shortcut li {
      text-align: center;
    }
    .category-shortcut li a {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #333;
      font-size: 1.2rem;
      font-weight: 700;
      transition: color 0.2s ease;
    }
    .category-shortcut li a:hover {
      color: #66aee8;
    }
    .category-shortcut li img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 30px;
      margin-top: 50px;
    }

    /* ===== ë±ƒì§€ (NEW, ìì²´ê°œë°œ) ===== */
    .badge {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 4px 8px;
      font-size: 0.8rem;
      color: #fff;
      border-radius: 4px;
      font-weight: bold;
    }
    .new-badge {
      background-color: #ff4d4f;
    }
    .custom-badge {
      background-color: #2db7f5;
    }

    /* ===== ì‚¬ì´ë“œ ë°°ë„ˆ (ë² ìŠ¤íŠ¸/NEW íƒ­ì—ì„œë§Œ) ===== */
	.side-banner-left,
	.side-banner-right {
	  position: fixed;
	  top: 50%; 
	  transform: translateY(-50%); 
	  z-index: 999;
	}
	
	/* ë°°ë„ˆê°€ ì¢€ ë” í™”ë©´ ì¤‘ì•™ ìª½ì— ì˜¤ë„ë¡ left/right ê°’ ì¡°ì • */
	.side-banner-left {
	  left: 80px;  /* ì™¼ìª½ì—ì„œ 80px */
	}
	.side-banner-right {
	  right: 80px; /* ì˜¤ë¥¸ìª½ì—ì„œ 80px */
	}
	
	/* ê¸°ì¥ì„ í‚¤ìš°ê³  í­ì€ ìë™ìœ¼ë¡œ ì„¤ì • */
	.side-banner-left img,
	.side-banner-right img {
	  width: auto;   
	  height: 450px; /* ê¸°ì¥ì„ ë„‰ë„‰íˆ 400px ì˜ˆì‹œ */
	  display: block;
	}
	
	/* ëª¨ë°”ì¼ ì´í•˜ì—ì„œ ìˆ¨ê¸°ê³  ì‹¶ë‹¤ë©´ */
	@media (max-width: 1024px) {
	  .side-banner-left,
	  .side-banner-right {
	    display: none;
	  }
	}
/* ê¸°ë³¸ ìƒíƒœ: ê¸€ììƒ‰ #333, ë°‘ì¤„ì€ íˆ¬ëª…(ìë¦¬ë§Œ í™•ë³´) */
.scrolling-tab .page-tab-area ul li a {
  color: #333;
  font-weight: 500;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-bottom-color 0.2s, font-weight 0.2s;
}

/* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ: í•˜ëŠ˜ìƒ‰ ì‚´ì§ ë¯¸ë¦¬ ì ìš©í•´ë„ ì¢‹ìŒ(ì„ íƒì‚¬í•­) */
.scrolling-tab .page-tab-area ul li a:hover {
  color: #68a5fe;
  font-weight: 600;
}

/* í™œì„± ìƒíƒœ(.active) ì‹œ: ê¸€ììƒ‰ & ë°‘ì¤„ìƒ‰ì„ ê°™ì€ í•˜ëŠ˜ìƒ‰(#68a5fe)ìœ¼ë¡œ! */
.scrolling-tab .page-tab-area ul li a.active {
  color: #68a5fe;                /* ê¸€ììƒ‰ í•˜ëŠ˜ìƒ‰ */
  font-weight: 700;             /* ë” ì§„í•˜ê²Œ */
  border-bottom: 2px solid #68a5fe;  /* ë°‘ì¤„ë„ í•˜ëŠ˜ìƒ‰ */
}
	
  </style>
</head>
<body>
  <!-- ê³µí†µ í—¤ë” -->
  <div th:replace="fragment/header :: headerFragment"></div>
  <!-- ìŠ¤í† ì–´ ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
  <div th:replace="fragment/nav :: navFragment2"></div>

  <div class="container">
    <div class="pm-section">
      <!-- sort ê°’ì— ë”°ë¼ í™”ë©´ ì „í™˜ -->
      <div th:switch="${sort}">

        <!-- (1) ìŠ¤í† ì–´í™ˆ (storeHome) -->
        <div th:case="'storeHome'">
          <!-- ë°°ë„ˆ -->
          <div class="banner-slider-container">
            <div class="swiper-container banner-swiper">
              <div class="swiper-wrapper">
                <div class="swiper-slide"><img src="/images/v1.jpg" alt="ë°°ë„ˆ1"></div>
                <div class="swiper-slide"><img src="/images/v2.jpg" alt="ë°°ë„ˆ2"></div>
                <div class="swiper-slide"><img src="/images/v3.jpg" alt="ë°°ë„ˆ3"></div>
              </div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
          </div>

          <!-- ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ ë°”ë¡œê°€ê¸° -->
          <section class="category-shortcut">
            <ul>
              <li>
                <a th:href="@{'/products/category/1'(petType='CAT', sort='newest')}">
                  <img src="/images/cat1.png" alt="ê³ ì–‘ì´ì‚¬ë£Œ ì•„ì´ì½˜"/>
                  <span>ê³ ì–‘ì´ì‚¬ë£Œ</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/2'(petType='CAT', sort='newest')}">
                  <img src="/images/cat2.png" alt="ê³ ì–‘ì´ê°„ì‹ ì•„ì´ì½˜"/>
                  <span>ê³ ì–‘ì´ê°„ì‹</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/3'(petType='CAT', sort='newest')}">
                  <img src="/images/cat3.png" alt="ê³ ì–‘ì´ìš©í’ˆ ì•„ì´ì½˜"/>
                  <span>ê³ ì–‘ì´ìš©í’ˆ</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/4'(petType='DOG', sort='newest')}">
                  <img src="/images/dog1.png" alt="ê°•ì•„ì§€ì‚¬ë£Œ ì•„ì´ì½˜"/>
                  <span>ê°•ì•„ì§€ì‚¬ë£Œ</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/5'(petType='DOG', sort='newest')}">
                  <img src="/images/dog2.png" alt="ê°•ì•„ì§€ê°„ì‹ ì•„ì´ì½˜"/>
                  <span>ê°•ì•„ì§€ê°„ì‹</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/6'(petType='DOG', sort='newest')}">
                  <img src="/images/dog3.png" alt="ê°•ì•„ì§€ìš©í’ˆ ì•„ì´ì½˜"/>
                  <span>ê°•ì•„ì§€ìš©í’ˆ</span>
                </a>
              </li>
            </ul>
          </section>

          <!-- ê°€ì„±ë¹„ ìƒí’ˆ ì„¹ì…˜ -->
          <section>
            <h2 class="section-title">ê°€ì„±ë¹„ ê°‘! ì•Œëœ°í•˜ê²Œ ë“í…œí•˜ì„¸ìš”</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${cheapProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                </div>
                <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'"></p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                  ë‹¹ì¼ë°œì†¡
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
              </div>
            </div>
          </section>

          <!-- ë² ìŠ¤íŠ¸ ìƒí’ˆ ì„¹ì…˜ -->
          <section>
            <h2 class="section-title">ëª¨ë‘ê°€ ì„ íƒí•œ ë² ìŠ¤íŠ¸! í•œ ë²ˆ ì¨ë³´ë©´ ë°˜í•´ìš”</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${bestProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                </div>
                <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'"></p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                  ë‹¹ì¼ë°œì†¡
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
              </div>
            </div>
          </section>

          <!-- ì‹ ìƒí’ˆ ì„¹ì…˜ -->
          <section>
            <h2 class="section-title">ë°©ê¸ˆ ì¶œì‹œëœ ë”°ëˆë”°ëˆ ì‹ ìƒ! ì§€ê¸ˆ ë§Œë‚˜ë³´ì„¸ìš”</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${newProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                </div>
                <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'"></p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                  ë‹¹ì¼ë°œì†¡
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
              </div>
            </div>
          </section>
        </div>

        <!-- (2) ì „ì²´ì œí’ˆ (all) -->
        <div th:case="'all'">
          <div class="main-container">
            <aside class="sidebar">
              <h2>ì¹´í…Œê³ ë¦¬</h2>
              <ul class="category-list">
                <li th:each="cat : ${categories}">
                  <a th:href="@{'/products/category/' + ${cat.categoryId} (petType=${selectedPetType}, sort='newest')}"
                     th:text="${cat.categoryName}">ì¹´í…Œê³ ë¦¬ëª…</a>
                </li>
              </ul>
              <div class="sidebar-buttons">
                <button id="togglePetBtn"></button>
                <a href="/products/add">ìƒí’ˆ ì¶”ê°€</a>
                <a href="/categories">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</a>
              </div>
            </aside>

            <div class="content">
              <div class="category-header" th:if="${currentCategory != null}">
                <h2 class="category-title" th:text="${currentCategory.categoryName}">ì¹´í…Œê³ ë¦¬ëª…</h2>

                <div class="top-controls" th:if="${subcategories != null and !subcategories.isEmpty()}">
                  <div class="subcategory-tabs">
                    <a th:href="@{'/products/category/' + ${currentCategory.categoryId} (petType=${selectedPetType}, sort='newest')}"
                       th:classappend="${selectedSubcategoryId == null} ? ' active'">ì „ì²´</a>
                    <a th:each="sub : ${subcategories}"
                       th:href="@{'/products/subcategory/' + ${sub.subcategoryId} (petType=${selectedPetType}, sort='newest')}"
                       th:classappend="${selectedSubcategoryId == sub.subcategoryId} ? ' active'">
                      <span th:text="${sub.subcategoryName}">ì†Œë¶„ë¥˜</span>
                    </a>
                  </div>
                </div>

                <div class="count-sort-row" th:if="${subcategories != null and !subcategories.isEmpty()}">
                  <div class="count-info">
                    ì´ <span th:text="${#lists.size(products)}"></span>ê°œ
                  </div>
                  <div class="sort-container">
                    <label for="sortFilter">ì •ë ¬:</label>
                    <select id="sortFilter" onchange="changeSort()">
                      <option value="newest" th:selected="${sort == 'newest'}">ì‹ ì œí’ˆìˆœ</option>
                      <option value="priceLowHigh" th:selected="${sort == 'priceLowHigh'}">ë‚®ì€ ê°€ê²©ìˆœ</option>
                      <option value="priceHighLow" th:selected="${sort == 'priceHighLow'}">ë†’ì€ ê°€ê²©ìˆœ</option>
                      <option value="rating" th:selected="${sort == 'rating'}">í‰ì ìˆœ</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="product-list">
                <div class="product-card" th:each="product : ${products}">
                  <div class="img-wrap">
                    <img th:src="@{${!#lists.isEmpty(product.imageUrls) ? product.imageUrls[0] : '/images/default.png'}}" alt="Product Image"/>
                    <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                    <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                  </div>
                  <h3 th:text="${product.productName}">ìƒí’ˆëª…</h3>
                  <p class="price" th:text="${#numbers.formatInteger(product.price, 0)} + 'ì›'"></p>
                  <p class="rating">
                    <span th:text="'â­ ' + ${#numbers.formatDecimal(product.averageRating != null ? product.averageRating : 0.0, 1, 1)}"></span>
                    <span th:text="'(' + (${product.reviewCount} != null ? ${product.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                  </p>
                  <p class="delivery-badge">
                    <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                    ë‹¹ì¼ë°œì†¡
                  </p>
                  <p class="category-info" th:text="'(' + ${product.category.categoryName} + ' / ' + ${product.subcategory.subcategoryName} + ')'"></p>
                  <a th:href="@{'/products/' + ${product.productId}}" class="details-link" th:if="${product.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- (3) ë² ìŠ¤íŠ¸ (rating) -->
        <div th:case="'rating'">
          <!-- ì™¼ìª½/ì˜¤ë¥¸ìª½ ê³ ì • ë°°ë„ˆ -->
          <div class="side-banner-left">
            <a href="#">
              <img src="/images/v4.png" alt="ì™¼ìª½ë°°ë„ˆ">
            </a>
          </div>
          <div class="side-banner-right">
            <a href="#">
              <img src="/images/v5.png" alt="ì˜¤ë¥¸ìª½ë°°ë„ˆ">
            </a>
          </div>

          <section class="main_home best_area">
            <h2>ë² ìŠ¤íŠ¸</h2>
            <div class="product-list">
              <div class="product-card" th:each="p, stat : ${products}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                  <span class="best-rank" th:text="${stat.count}">1</span>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                </div>
                <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'"></p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                  ë‹¹ì¼ë°œì†¡
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
              </div>
            </div>
          </section>
        </div>

        <!-- (4) NEW (newest) -->
        <div th:case="'newest'">
          <!-- ì™¼ìª½/ì˜¤ë¥¸ìª½ ê³ ì • ë°°ë„ˆ -->
          <div class="side-banner-left">
            <a href="#">
              <img src="/images/v4.png" alt="ì™¼ìª½ë°°ë„ˆ">
            </a>
          </div>
          <div class="side-banner-right">
            <a href="#">
              <img src="/images/v5.png" alt="ì˜¤ë¥¸ìª½ë°°ë„ˆ">
            </a>
          </div>

          <section class="main_home new_area">
            <h2>NEW</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${products}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">ìì²´ê°œë°œ</div>
                </div>
                <h3 th:text="${p.productName}">ìƒí’ˆëª…</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + 'ì›'"></p>
                <p class="rating">
                  <span th:text="'â­ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + 'ê°œ ë¦¬ë·°)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="ë°°ì†¡ì•„ì´ì½˜">
                  ë‹¹ì¼ë°œì†¡
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">ìì„¸íˆ ë³´ê¸°</a>
              </div>
            </div>
          </section>
        </div>

        <!-- fallback -->
        <div th:case="*">
          <p>ì•Œ ìˆ˜ ì—†ëŠ” íƒ­ì…ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- í‘¸í„° -->
  <div th:replace="fragment/footer :: footerFragment"></div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

  <!-- petType ê´€ë ¨ JS -->
  <script th:inline="javascript">
    let currentPetType = /*[[${selectedPetType}]]*/ 'ALL';
    const toggleStates = [
      { label: 'ê³ ì–‘ì´ ğŸ±',  type: 'CAT', url: '/products?petType=CAT&sort=all' },
      { label: 'ê°•ì•„ì§€ ğŸ¶',  type: 'DOG', url: '/products?petType=DOG&sort=all' },
      { label: 'ì „ì²´ìƒí’ˆë³´ê¸°', type: 'ALL', url: '/products?sort=all' }
    ];
    let currentIndex = (currentPetType === 'CAT') ? 0 : (currentPetType === 'DOG' ? 1 : 2);

    function setButtonLabel() {
      document.getElementById('togglePetBtn').textContent = toggleStates[currentIndex].label;
    }
    function togglePetType() {
      currentIndex = (currentIndex + 1) % toggleStates.length;
      window.location.href = toggleStates[currentIndex].url;
    }

    function changeSort() {
      const selectedSort = document.getElementById("sortFilter").value;
      const url = new URL(window.location.href);
      url.searchParams.set("sort", selectedSort);
      window.location.href = url.toString();
    }

    document.addEventListener('DOMContentLoaded', function() {
      const togglePetBtn = document.getElementById('togglePetBtn');
      if (togglePetBtn) {
        setButtonLabel();
        togglePetBtn.addEventListener('click', togglePetType);
      }

      // ê°€ê²©ì— 3ìë¦¬ ì½¤ë§ˆ ë„£ê¸°
      const priceElements = document.querySelectorAll('.price');
      priceElements.forEach(el => {
        const rawText = el.textContent.replace(/[^\d]/g,'');
        const priceNum = parseInt(rawText, 10) || 0;
        el.textContent = priceNum.toLocaleString('en-US') + 'ì›';
      });

      // ë©”ì¸ ë°°ë„ˆ Swiper ì´ˆê¸°í™”
      new Swiper('.banner-swiper', {
        loop: true,
        autoplay: { delay: 3000, disableOnInteraction: false },
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
      });
    });
    
  </script>
</body>
</html>
